<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Rx Test</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.25/browser.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.25/browser-polyfill.min.js"></script>
</head>
<body>
  <div id="root">
    <div>
      <h3>Response</h3>
      <ul id="response"></ul>

      <button id="refresh">Refresh</button>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0-alpha1/jquery.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/rxjs/4.0.6/rx.all.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/rxjs-dom/7.0.3/rx.dom.min.js"></script>

  <script type="text/babel">
    console.log('Rx', Rx);

    const refreshButton = document.getElementById('refresh');
    const refreshClickStream = Rx.Observable.fromEvent(refreshButton, 'click');

    const requestStream = refreshClickStream
      .startWith('startup click')
      .map(() => {
        const randomOffset = Math.floor(Math.random()*500);
        return 'https://api.github.com/users?since=' + randomOffset;
      });

    const responseStream = requestStream
      .flatMap(function(requestUrl) {
        return Rx.Observable.fromPromise(jQuery.getJSON(requestUrl));
      });

    responseStream.subscribe(function(response) {
      // render `response` to the DOM however you wish
      console.log('response', response);
      const node = document.getElementById('response')
      node.innerHTML = response.map(user => `<li>${user.login} ${user.id}</li>`).join('');
    });


  </script>
</body>
</html>
